<ion-header>
  <ion-toolbar>
    <div class="header-content">
      <ion-title class="responsive-title">Event Details</ion-title>
    </div>
  </ion-toolbar>
</ion-header>


<ion-breadcrumbs>
  <ion-breadcrumb routerLink="/admin">
    <ion-icon name="home"></ion-icon>
    <span>Dashboard</span>
  </ion-breadcrumb>
  <ion-breadcrumb routerLink="/admin/events">
    <ion-icon name="calendar"></ion-icon>
    <span>Events</span>
  </ion-breadcrumb>
  <ion-breadcrumb>
    <ion-icon name="calendar-number-sharp"></ion-icon>
    <span>Events</span>
  </ion-breadcrumb>
</ion-breadcrumbs>

<ion-content class="ion-padding">
  <ion-card>
    <ion-card-header>
      <ion-card-title>{{ event?.name }}</ion-card-title>
      <ion-card-subtitle>{{ event?.startDate | date }} - {{ event?.endDate | date }}</ion-card-subtitle>
    </ion-card-header>
    <ion-card-content>
      <p><strong>Description:</strong> {{ event?.description }}</p>
      <p><strong>Registration Period:</strong> {{ event?.registrationStartDate | date: 'mediumDate' }} - {{ event?.registrationEndDate | date: 'mediumDate' }}</p>
      <p><strong>Location:</strong> {{ event?.locationDetails }}</p>
      <p><strong>Event Manager:</strong> {{ event?.eventManagerName }} ({{ event?.eventManagerContactNumber }})</p>
      <p><strong>Email:</strong> {{ event?.eventManagerEmailId }}</p>

      <div *ngIf="event?.slots?.length">
        <h4>Slots</h4>
        <ul>
          <li *ngFor="let slot of event?.slots">
            {{ slot.slotId }}: {{ slot.startDate | date }} - {{ slot.endDate | date }}
          </li>
        </ul>
      </div>
      <div *ngIf="!event?.slots?.length">
        <p>No slots available for this event.</p>
      </div>
    </ion-card-content>
  </ion-card>

<!-- Actions Section: Refresh and Export -->
<ion-card *ngIf="assignments.length > 0">
  <ion-card-header>
    <ion-card-title>Actions</ion-card-title>
  </ion-card-header>
  <ion-card-content>
    <div class="buttons-wrapper" style="display: flex; justify-content: space-around;">
      <div style="flex: 1; display: flex; justify-content: center;">
        <ion-button (click)="refreshPage()">
          <ion-icon slot="start" name="refresh"></ion-icon>
          Refresh
        </ion-button>
      </div>
      <div style="flex: 1; display: flex; justify-content: center;">
        <ion-button (click)="exportToExcel()">
          <ion-icon slot="start" name="document-outline"></ion-icon>
          Export to Excel
        </ion-button>
      </div>
    </div>
  </ion-card-content>
</ion-card>




<!-- Filters Section -->
<ion-card *ngIf="assignments.length > 0">
  <ion-card-header>
    <ion-card-title>Filters</ion-card-title>
  </ion-card-header>
  <ion-card-content>
    <div class="filters-wrapper">
      <div class="filter-item">
        <ion-item>
          <ion-label position="stacked">Search by Name</ion-label>
          <ion-searchbar [(ngModel)]="filterName" placeholder="Enter volunteer's name"></ion-searchbar>
        </ion-item>
      </div>

      <div class="filter-item">
        <ion-item>
          <ion-label>Center</ion-label>
          <ion-select [(ngModel)]="filterCenter">
            <ion-select-option value="">All Centers</ion-select-option>
            <ion-select-option *ngFor="let center of centers" [value]="center">{{ center }}</ion-select-option>
          </ion-select>
        </ion-item>
      </div>

      <div class="filter-item">
        <ion-item>
          <ion-label>Gender</ion-label>
          <ion-select [(ngModel)]="filterGender">
            <ion-select-option value="">All Genders</ion-select-option>
            <ion-select-option value="male">Male</ion-select-option>
            <ion-select-option value="female">Female</ion-select-option>
            <ion-select-option value="other">Other</ion-select-option>
            <!-- Add more options as needed -->
          </ion-select>
        </ion-item>
      </div>

      <div class="filter-item">
        <ion-item>
          <ion-label>Admin Status</ion-label>
          <ion-select [(ngModel)]="filterAdminStatus">
            <ion-select-option value="">All Statuses</ion-select-option>
            <ion-select-option value="review-pending">Review Pending</ion-select-option>
            <ion-select-option value="waiting">Waiting</ion-select-option>
            <ion-select-option value="approved">Approved</ion-select-option>
            <ion-select-option value="rejected">Rejected</ion-select-option>
          </ion-select>
        </ion-item>
      </div>

      <div class="filter-item">
        <ion-item>
          <ion-label>Slots</ion-label>
          <ion-select multiple="true" [(ngModel)]="filterSlots">
            <ion-select-option *ngFor="let slot of event?.slots" [value]="slot.slotId">
              {{ slot.slotId }}: {{ slot.startDate | date }} - {{ slot.endDate | date }}
            </ion-select-option>
          </ion-select>
        </ion-item>
      </div>

      <div class="filter-item">
        <ion-button color="light" expand="block" (click)="resetFilters()">Reset Filters</ion-button>
      </div>
    </div>
  </ion-card-content>
</ion-card>


<!-- Volunteers Section with Pagination -->
<ion-card>
  <ion-card-header>
    <ion-card-title>Registered Volunteers</ion-card-title>
  </ion-card-header>
  <ion-card-content>
    <ion-list *ngIf="assignments.length > 0">
      <ion-item *ngFor="let assignment of paginatedAssignments | sort: 'volunteer.name'">
        <ion-label>
          <h2>{{ assignment.volunteer.name }}</h2>
          <p><strong>Phone:</strong> {{ assignment.volunteer.phoneNumber }}</p>
          <p><strong>Gender:</strong> {{ assignment.volunteer.gender }}</p>
          <p><strong>Age:</strong> {{ assignment.volunteer.age }}</p>
          <p><strong>Center:</strong> {{ assignment.center.name }}</p>
          <p><strong>Center Location:</strong> {{ assignment.center.location }}</p>
          <p><strong>POC:</strong> {{ assignment.poc?.name }}</p>
          <p><strong>POC Phone:</strong> {{ assignment.poc?.phoneNumber }}</p>
          <p><strong>Admin Status:</strong> {{ assignment.adminApprovalStatus }}</p>
          <p><strong>Admin Comment:</strong> {{ assignment.adminComment || 'No comments' }}</p>
          <p><strong>Arrival Date:</strong> {{ assignment.volunteerArrivalDate ? (assignment.volunteerArrivalDate | date) : 'Not provided' }}</p>
          <p><strong>Train Number:</strong> {{ assignment.trainNumber || 'Not provided' }}</p>
          <p><strong>POC Comment:</strong> {{ assignment.pocComment || 'No comments' }}</p>
          <p><strong>Slots Selected:</strong> {{ assignment.slotsSelected.join(', ') }}</p>
        </ion-label>
        <ion-button slot="end" color="tertiary" (click)="openEditModal(assignment)">
          Edit
        </ion-button>
      </ion-item>
    </ion-list>
    <div *ngIf="filteredAssignments.length === 0">
      <p>No volunteers registered for this event.</p>
    </div>

<!-- Pagination Controls -->
<ion-footer *ngIf="assignments.length > 0">
  <ion-toolbar>
    <ion-grid>
      <ion-row>
        <ion-col size-lg="4" size-sm="12" class="ion-text-left ion-justify-content-end">
          <ion-buttons>
            <ion-button (click)="prevPage()" [disabled]="currentPage === 1">
              <ion-icon name="chevron-back" slot="start"></ion-icon>
              Previous
            </ion-button>
          </ion-buttons>
        </ion-col>
        <ion-col size-lg="4" size-sm="12" class="ion-text-center">
          <ion-title>
            Page {{ currentPage }} of {{ totalPages }} | Total Records: {{ filteredAssignments.length }}
          </ion-title>
        </ion-col>
        <ion-col size-lg="4" size-sm="12" class="ion-text-right">
          <ion-buttons>
            <ion-button (click)="nextPage()" [disabled]="currentPage >= totalPages">
              Next
              <ion-icon name="chevron-forward" slot="end"></ion-icon>
            </ion-button>
          </ion-buttons>
        </ion-col>
      </ion-row>
    </ion-grid>
  </ion-toolbar>
</ion-footer>
  </ion-card-content>
</ion-card>
</ion-content>
