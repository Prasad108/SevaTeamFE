<ion-header>
  <ion-toolbar>
    <ion-title>Update Volunteer Details</ion-title>
  </ion-toolbar>
</ion-header>

<ion-breadcrumbs>
  <ion-breadcrumb routerLink="/poc">
    <ion-icon name="home"></ion-icon>
    <span>Dashboard</span>
  </ion-breadcrumb>
  <ion-breadcrumb routerLink="/poc/events">
    <ion-icon name="calendar-outline"></ion-icon>
    <span>Manage Events</span>
  </ion-breadcrumb>
  <ion-breadcrumb>
    <ion-icon name="people"></ion-icon>
    <span>Volunteer Details</span>
  </ion-breadcrumb>
</ion-breadcrumbs>

<ion-content class="ion-padding">

  <!-- Event Details Section -->
  <ion-card>
    <ion-card-header>
      <ion-card-title>{{ selectedEvent?.name }}</ion-card-title>
      <ion-card-subtitle>{{ selectedEvent?.startDate | date }} - {{ selectedEvent?.endDate | date }}</ion-card-subtitle>
    </ion-card-header>
    <ion-card-content>
      <p><strong>Description:</strong> {{ selectedEvent?.description }}</p>
      <p><strong>Registration Period:</strong> {{ selectedEvent?.registrationStartDate | date: 'mediumDate' }} - {{ selectedEvent?.registrationEndDate | date: 'mediumDate' }}</p>
      <p><strong>Location:</strong> {{ selectedEvent?.locationDetails }}</p>
      <p><strong>Event Manager:</strong> {{ selectedEvent?.eventManagerName }} ({{ selectedEvent?.eventManagerContactNumber }})</p>
      <p><strong>Email:</strong> {{ selectedEvent?.eventManagerEmailId }}</p>

      <div *ngIf="selectedEvent?.slots?.length">
        <h4>Slots</h4>
        <ul>
          <li *ngFor="let slot of selectedEvent?.slots">
            {{ slot.slotId }}: {{ slot.startDate | date }} - {{ slot.endDate | date }}
          </li>
        </ul>
      </div>
      <div *ngIf="!selectedEvent?.slots?.length">
        <p>No slots available for this event.</p>
      </div>
    </ion-card-content>
  </ion-card>

<!-- Registration Start in Future -->
<ion-card *ngIf="isRegistrationFuture">
  <ion-card-content>
    <p style="color: red; font-weight: bold;">Note</p>
    <p>Volunteer registration for this event will start from {{ selectedEvent?.registrationStartDate | date: 'mediumDate' }}.</p>
  </ion-card-content>
</ion-card>

<!-- Registration Ended in the Past -->
<ion-card *ngIf="isRegistrationClosed">
  <ion-card-content>
    <p style="color: red; font-weight: bold;">Note</p>
    <p>Volunteer registration window for this event is closed. You can still update the details of your already added volunteers, but you cannot add or remove volunteers. For any queries, please contact the event manager.</p>
    <p><strong>Event Manager:</strong> {{ selectedEvent?.eventManagerName }} ({{ selectedEvent?.eventManagerContactNumber }})</p>
    <p><strong>Email:</strong> {{ selectedEvent?.eventManagerEmailId }}</p>
  </ion-card-content>
</ion-card>

  <!-- Available Volunteers Section -->
  <ion-card *ngIf="!isRegistrationFuture">
    <ion-card-header>
      <ion-card-title>Available Volunteers</ion-card-title>
    </ion-card-header>
    <ion-card-content>
      <ion-list *ngIf="availableVolunteers.length > 0">
        <ion-item *ngFor="let volunteer of availableVolunteers">
          <ion-label>
            <h2>{{ volunteer.name }}</h2>
            <p>Phone: {{ volunteer.phoneNumber }}</p>
            <p>Gender: {{ volunteer.gender }}</p>
            <p>Age: {{ volunteer.age }}</p>
          </ion-label>
          <ion-button color="primary" (click)="addVolunteerToEvent(volunteer)" [disabled]="isRegistrationClosed">
            Add to Event
          </ion-button>
        </ion-item>
      </ion-list>
      <div *ngIf="availableVolunteers.length === 0">
        <p>No volunteers available.</p>
      </div>
    </ion-card-content>
  </ion-card>

  <!-- Assigned Volunteers Section -->
  <ion-card *ngIf="!isRegistrationFuture">
    <ion-card-header>
      <ion-card-title>Assigned Volunteers</ion-card-title>
    </ion-card-header>
    <ion-card-content>
      <ion-list *ngIf="assignedVolunteers.length > 0">
        <ion-item *ngFor="let assignment of assignedVolunteers">
          <ion-label>
            <h2>{{ getVolunteerName(assignment.volunteerId) }}</h2>
            <p>Arrival: {{ assignment.volunteerArrivalDate?.toDate() | date }}</p>
            <p>Slots Selected: {{ assignment.slotsSelected.join(', ') }}</p>
          </ion-label>
          <ion-button color="tertiary" (click)="updateVolunteerAssignment(assignment)">
            Edit
          </ion-button>
          <ion-button color="danger" (click)="removeVolunteerFromEvent(assignment)" [disabled]="isRegistrationClosed">
            Remove
          </ion-button>
        </ion-item>
      </ion-list>
      <div *ngIf="assignedVolunteers.length === 0">
        <p>No volunteers assigned to this event.</p>
      </div>
    </ion-card-content>
  </ion-card>

</ion-content>
